@page
@model Dental_Surgery.Pages.IndexModel
@{
    ViewData["Title"] = "Dashboard & Schedule";
    var hour = DateTime.Now.Hour;
    var greeting = hour < 12 ? "Good morning" : (hour < 16 ? "Good afternoon" : "Good evening");
}

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script>
        feather.replace();
    </script>
    <script src="~/js/schedule.js"></script>
}

<h2 class="mb-4">
    @greeting@if (!string.IsNullOrEmpty(Model.DisplayName))
    {
        <text>, @Model.DisplayName</text>
    }
</h2>

@if (User.IsInRole("Receptionist"))
{
    <!-- 🔹 TOP ROW: Big Buttons -->
    <div class="container mb-4">
        <div class="row g-3 justify-content-center">
            <div class="col-md-4">
                <a class="btn btn-primary btn-lg w-100" asp-page="/Admin2/Patients/Create">➕ Add New Patient</a>
            </div>
            <div class="col-md-4">
                <a class="btn btn-success btn-lg w-100" asp-page="/Admin2/Appointments/Create">📅 Make Appointment</a>
            </div>
            <div class="col-md-4">
                <a asp-page="/Admin2/Patients/Index" class="btn btn-info btn-lg w-100">👥 View Patients</a>

            </div>
        </div>
    </div>

    <!-- 🔹 STATS BELOW BUTTONS -->
    <div class="container mb-5">
        <div class="row justify-content-center">
            <div class="col-md-6 col-lg-4">
                <div class="card p-4 shadow-sm text-center">
                    <div class="d-flex justify-content-center align-items-center mb-3">
                        <i data-feather="bar-chart-2" class="me-2"></i>
                        <h5 class="mb-0">Today's Summary</h5>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Appointments Today</span>
                        <span class="fs-4 fw-bold text-primary">@Model.AppointmentsToday</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Dentists on Duty</span>
                        <span class="fs-4 fw-bold text-success">@Model.DentistsOnDuty</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 🔹 MIDDLE: Schedule Centered -->
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                @await Html.PartialAsync("/Pages/Shared/_SchedulePartial.cshtml", Model)
            </div>
        </div>
    </div>
}

@if (User.IsInRole("Dentist"))
{
    <div class="card shadow-sm p-4 mb-4">
        <h3 class="mb-3">🦷 Dentist Dashboard</h3>
        <ul class="list-group mb-3">
            <li class="list-group-item d-flex justify-content-between">
                <span>Appointments Today:</span>
                <strong>@Model.AppointmentsToday</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between">
                <span>Next Appointment:</span>
                <strong>@Model.NextAppointmentTime - @Model.NextPatientName</strong>
            </li>
        </ul>
        <div>
            <a class="btn btn-primary me-2" asp-page="/Shared/Schedule">📅 View My Schedule</a>
            <a class="btn btn-secondary" asp-page="/Admin2/Patients/History">📄 Patient History</a>
        </div>
    </div>
}
