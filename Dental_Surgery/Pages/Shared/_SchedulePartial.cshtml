@model Dental_Surgery.Pages.IndexModel

<div class="container-xl px-0" style="max-width: 1200px; margin-left: 0; margin-right: auto;">
    <div class="table-responsive" style="overflow-y: auto; max-height: calc(100vh - 300px);">

        <table class="table table-bordered align-middle table-white" style="table-layout: fixed;">
            <thead class="table-dark">
                <tr>
                    <th style="width: 10%;">Time</th>
                    @if (!Model.IsDentist)
                    {
                        <th style="width: 20%;">Dentist</th>
                    }
                    <th class="patient-column" style="width: 25%;">
                        <div class="d-flex justify-content-between align-items-center">
                            <span id="patientHeaderText">Patient</span>
                            <i data-feather="search" class="search-icon" style="cursor: pointer;" onclick="togglePatientSearch()"></i>
                        </div>
                        <div class="patient-search-container" style="display: none;">
                            <input type="text"
                                   id="patientSearch"
                                   class="form-control w-100 border-0 rounded-10 bg-white"
                                   placeholder="Search for patient..."
                                   onkeyup="searchPatients()" />
                        </div>
                    </th>
                    <th style="width: 35%;">Treatment</th>
                    @if (!Model.IsDentist)
                    {
                        <th style="width: 10%;">Attended</th>
                    }
                </tr>
            </thead>
            <tbody id="appointmentsTBody">
                @if (Model.DailyAppointments.Any())
                {
                    @foreach (var appt in Model.DailyAppointments)
                    {
                        <tr class="appointment-row clickable-row"
                            data-patient-name="@($"{appt.Patient?.FirstName} {appt.Patient?.LastName}")"
                            data-href="/Admin2/Appointments/Details?id=@appt.AppointmentId">

                            <td>@appt.AppointmentDate.ToString("HH:mm")</td>
                            @if (!Model.IsDentist)
                            {
                                <td>@appt.Dentist?.FirstName @appt.Dentist?.LastName</td>
                            }
                            <td>@appt.Patient?.FirstName @appt.Patient?.LastName</td>
                            <td>@appt.Treatment?.Name</td>
                            @if (!Model.IsDentist)
                            {
                                <td class="no-click">
                                    <div class="form-check d-flex justify-content-center">
                                        <input class="form-check-input attendance-checkbox" type="checkbox"
                                               data-id="@appt.AppointmentId" @(appt.attend ? "checked" : "")
                                               style="display: none;" />
                                        <i data-feather="@(appt.attend ? "check-square" : "square")"
                                           class="attendance-icon"
                                           data-id="@appt.AppointmentId"></i>
                                    </div>
                                </td>
                            }
                        </tr>
                    }
                }
                else
                {
                    <tr class="appointment-row">
                        <td colspan="@(Model.IsDentist ? "3" : "5")" class="border-0">No appointments.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

  



<style>
    
    
    td {
        white-space: normal;
        word-wrap: break-word;
    }
    
    .patient-column {
        position: relative;
    }

    .patient-search-container {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--bs-dark);
        padding: 0.5rem;
    }

        .patient-search-container input {
            height: 100%;
            outline: none;
            box-shadow: none;
            border: none !important;
        }

            .patient-search-container input:focus {
                outline: none !important;
                box-shadow: none !important;
                border-color: transparent !important;
            }

    .clickable-row {
        cursor: pointer;
    }

    .attendance-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 30px;
        height: 30px;
        line-height: 1;
        margin: 0 auto;
        color: #6e7174;
        transition: transform 0.2s;
    }


        .attendance-icon:hover {
            transform: scale(1.1);
            color: var(--bs-primary-dark);
        }

    .clickable-row:hover td:not(.no-click) {
        background-color: rgba(0, 0, 0, 0.05);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .no-click {
        cursor: default !important;
        padding: 0 !important;
        display: flex;
        justify-content: center;
        align-items: center;
    }

        .no-click .form-check {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            min-height: 50px;
            margin: 0;
            padding: 0;
        }

        /* attended cell background is light green */
        .no-click.attended-cell {
            background-color: rgba(76, 175, 80, 0.1) !important;
            position: relative;
        }
            /* adds border to green attended cell */
            .no-click.attended-cell::after {
                content: '';
                position: absolute;
                top: 0px;
                left: 0px;
                right: 0px;
                bottom: 0px;
                border: 2px solid rgba(76, 175, 80, 0.3);
                pointer-events: none;
            }

            .no-click.attended-cell .attendance-icon {
                color: #2E7D32; /* icon is dark green */
                z-index: 1; /* icon is in front of background */
            }

            /* Hover colour for attended cells */
            .no-click.attended-cell:hover {
                background-color: rgba(76, 175, 80, 0.3) !important;
            }
</style>
